{% extends "base.html" %}

{% block title %}Historial de Transacciones{% endblock %}

{% block content %}
<div class="container my-4">
    <h1 class="mb-4">Historial de Transacciones</h1>
    
    {% if transacciones %}
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Fecha</th>
                        <th>Tipo</th>
                        <th>Método</th>
                        <th>Créditos</th>
                        <th>Monto</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody>
                    {% for t in transacciones %}
                    <tr>
                        <td>{{ t.transaction_id[:8] }}...</td>
                        <td>{{ t.fecha_transaccion.strftime('%d/%m/%Y %H:%M') if t.fecha_transaccion and t.fecha_transaccion.strftime else t.fecha_transaccion }}</td>
                        <td>{{ t.tipo }}</td>
                        <td>{{ t.metodo_pago }}</td>
                        <td class="{{ 'text-danger' if t.creditos < 0 else 'text-success' }}">{{ t.creditos }}</td>
                        <td>${{ t.monto }}</td>
                        <td>
                            <span class="badge bg-{{ 'success' if t.estado == 'completado' else 'warning' }}">
                                {{ t.estado }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Paginación -->
        {% if total_pages > 1 %}
        <nav aria-label="Navegación de páginas">
            <ul class="pagination justify-content-center">
                <li class="page-item {{ 'disabled' if page == 1 else '' }}">
                    <a class="page-link" href="{{ url_for('dashboard.historial', page=page-1) if page > 1 else '#' }}">Anterior</a>
                </li>
                
                {% for p in range(1, total_pages + 1) %}
                <li class="page-item {{ 'active' if p == page else '' }}">
                    <a class="page-link" href="{{ url_for('dashboard.historial', page=p) }}">{{ p }}</a>
                </li>
                {% endfor %}
                
                <li class="page-item {{ 'disabled' if page == total_pages else '' }}">
                    <a class="page-link" href="{{ url_for('dashboard.historial', page=page+1) if page < total_pages else '#' }}">Siguiente</a>
                </li>
            </ul>
        </nav>
        {% endif %}
    {% else %}
        <div class="alert alert-info">
            No hay transacciones registradas.
        </div>
    {% endif %}
    
    <div class="mt-4">
        <a href="{{ url_for('dashboard.index') }}" class="btn btn-secondary">Volver al Dashboard</a>
    </div>
</div>
{% endblock %}